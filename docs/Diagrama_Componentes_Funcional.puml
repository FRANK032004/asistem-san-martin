@startuml Diagrama_Componentes_Sistema_Simple
!theme cerulean-outline
title **DIAGRAMA DE COMPONENTES DEL SISTEMA**\n**INSTITUTO SAN MART√çN

skinparam {
  backgroundColor #FEFEFE
  shadowing false
  roundcorner 8
  defaultFontSize 11
  packageBorderThickness 2
}

skinparam component<<frontend>> {
  BackgroundColor #E3F2FD
  BorderColor #1976D2
  BorderThickness 2
}

skinparam component<<backend>> {
  BackgroundColor #F3E5F5
  BorderColor #7B1FA2
  BorderThickness 2
}

skinparam component<<database>> {
  BackgroundColor #E8F5E8
  BorderColor #388E3C
  BorderThickness 2
}

skinparam component<<external>> {
  BackgroundColor #FFF3E0
  BorderColor #F57C00
  BorderThickness 2
}

skinparam package {
  BackgroundColor #F8F9FA
  BorderColor #6C757D
  BorderThickness 2
  FontStyle bold
}

' =============== CAPA DE PRESENTACI√ìN ===============
package "üé® CAPA DE PRESENTACI√ìN" as presentation {
  component [**Interfaz Web**\nNext.js 15.5\nReact + TypeScript] as webapp <<frontend>>
  component [**Componentes UI**\nShadcn/ui + Tailwind\nDesign System] as ui_components <<frontend>>
  component [**Estado Global**\nZustand Store\nManejo de Estado] as state_management <<frontend>>
  component [**Cliente HTTP**\nAxios + Interceptors\nAPI Communication] as http_client <<frontend>>
}

' =============== CAPA DE SERVICIOS ===============
package "‚öôÔ∏è CAPA DE SERVICIOS" as services {
  component [**API Gateway**\nExpress.js Router\nPunto de Entrada] as api_gateway <<backend>>
  component [**Autenticaci√≥n**\nJWT Middleware\nValidaci√≥n de Tokens] as auth_middleware <<backend>>
  component [**Controladores**\nBusiness Logic\nMVC Controllers] as controllers <<backend>>
  component [**Servicios GPS**\nGeolocation Validator\nValidaci√≥n de Ubicaci√≥n] as gps_service <<backend>>
}

' =============== CAPA DE ACCESO A DATOS ===============
package "üóÑÔ∏è CAPA DE ACCESO A DATOS" as data_access {
  component [**ORM Prisma**\nDatabase Abstraction\nType-Safe Queries] as orm_prisma <<backend>>
  component [**Repositorios**\nData Access Layer\nRepository Pattern] as repositories <<backend>>
  component [**Validaciones**\nData Validation\nZod Schemas] as validations <<backend>>
}

' =============== CAPA DE DATOS ===============
package "üíæ CAPA DE DATOS" as data_layer {
  component [**PostgreSQL 17**\nBase de Datos Principal\n17 Tablas Relacionales] as postgres_db <<database>>
  component [**PostGIS**\nExtensi√≥n Geoespacial\nC√°lculos GPS] as postgis <<database>>
}

' =============== SERVICIOS EXTERNOS ===============
package "üåê SERVICIOS EXTERNOS" as external_services {
  component [**Navegador Web**\nChrome/Firefox/Safari\nCliente de la App] as browser <<external>>
  component [**API Geolocalizaci√≥n**\nNavigator.geolocation\nCoordenadas GPS] as geo_api <<external>>
  component [**Sistema Operativo**\nWindows/Linux/macOS\nRecursos del Sistema] as operating_system <<external>>
}

' =============== RELACIONES ENTRE COMPONENTES ===============

' Frontend Flow
browser --> webapp : "Interacci√≥n Usuario"
webapp --> ui_components : "Renderizado de Componentes"
webapp --> state_management : "Gesti√≥n de Estado"
webapp --> http_client : "Llamadas API"
browser --> geo_api : "Solicitud GPS"
geo_api --> webapp : "Coordenadas"

' API Communication
http_client --> api_gateway : "HTTP Requests\n(Puerto 5000)"
api_gateway --> auth_middleware : "Validaci√≥n JWT"
auth_middleware --> controllers : "Request Autorizado"

' Business Logic
controllers --> repositories : "Operaciones de Datos"
controllers --> gps_service : "Validaci√≥n GPS"
repositories --> validations : "Validaci√≥n de Datos"
repositories --> orm_prisma : "Consultas ORM"

' Data Layer
orm_prisma --> postgres_db : "SQL Queries"
gps_service --> postgis : "Consultas GIS"
postgres_db --> operating_system : "Recursos del Sistema"

' Response Flow (dotted arrows)
postgres_db ..> orm_prisma : "Resultados SQL"
postgis ..> gps_service : "Datos Geoespaciales"
orm_prisma ..> repositories : "Datos Procesados"
repositories ..> controllers : "Respuesta de Datos"
controllers ..> api_gateway : "Respuesta Business"
api_gateway ..> http_client : "HTTP Response"
http_client ..> webapp : "Datos para UI"

' =============== NOTAS EXPLICATIVAS ===============

note top of webapp : **üéØ INTERFAZ PRINCIPAL**\nSingle Page Application\nServer Side Rendering\nOptimizaci√≥n Turbopack

note right of api_gateway : **üö™ PUNTO DE ENTRADA**\nEnrutamiento de solicitudes\nControl CORS y seguridad\nMiddleware pipeline

note bottom of postgres_db : **üíæ ALMACENAMIENTO**\n17 tablas sincronizadas\n√çndices optimizados\nBackup autom√°tico

note left of gps_service : **üìç VALIDACI√ìN GPS**\nRadio de 50 metros\nC√°lculo de distancias\nPrevenci√≥n de spoofing

' =============== LEYENDA T√âCNICA ===============

legend bottom center
|= **TIPOS DE COMPONENTES** |= **TECNOLOG√çAS CLAVE** |
| üé® **Frontend:** Interfaz y presentaci√≥n | **Next.js 15.5** - Framework React con SSR |
| ‚öôÔ∏è **Backend:** L√≥gica de negocio | **Express.js** - Servidor web Node.js |
| üóÑÔ∏è **Data Access:** Acceso a datos | **Prisma ORM** - Type-safe database access |
| üíæ **Database:** Almacenamiento | **PostgreSQL 17** - Base relacional |
| üåê **External:** Servicios externos | **Web APIs** - Geolocalizaci√≥n nativa |

|= **PATRONES ARQUITECT√ìNICOS** |= **COMUNICACI√ìN** |
| **Arquitectura por Capas** - Separaci√≥n responsabilidades | **HTTP/REST** - API RESTful |
| **Repository Pattern** - Abstracci√≥n de datos | **JWT** - Autenticaci√≥n stateless |
| **MVC Pattern** - Modelo Vista Controlador | **WebSocket** - Tiempo real (futuro) |
| **Middleware Pattern** - Pipeline de procesamiento | **GPS** - Validaci√≥n geogr√°fica |
end legend

@enduml